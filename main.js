(()=>{"use strict";const e={setLocalStorageItem(e,t){"undefined"!=typeof window&&void 0!==window.localStorage&&localStorage.setItem(e,JSON.stringify(t))},getLocalStorageItem(e){if("undefined"!=typeof window&&void 0!==window.localStorage){let t=localStorage.getItem(e);if(void 0!==t&&"undefined"!=t&&null!=t)return JSON.parse(localStorage.getItem(e))}return null}},t={createTemplate(e){const t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t},handleBcdUpdate:function(t,a,o){let i=e.getLocalStorageItem("GaadiData")||{},n=a||i.bcdList||[];if(t.key)if(this.isKeyInBcdList(t.key,a)){let e=n.findIndex((e=>e.key==t.key));e>=0&&n[e]&&(n[e].value=t.value,n[e].returnUrl=t.returnUrl,n[e].group=t.group)}else null!=o||null!=o?n.splice(o,0,{value:t.value,key:t.key,returnUrl:t.returnUrl,group:t.group}):n.push({value:t.value,key:t.key,returnUrl:t.returnUrl,group:t.group});return this.updateLocalStorage({bcdList:n}),n},updateLocalStorage:function(t){let a=e.getLocalStorageItem("GaadiData")||{};a={...a,...t},e.setLocalStorageItem("GaadiData",a)},isKeyInBcdList:function(t,a){let o=e.getLocalStorageItem("GaadiData")||{},i=a||o.bcdList||[],n=!1;return i.forEach((e=>{e.key===t&&(n=!0)})),n},ordinal_suffix_of(e){var t=e%10,a=e%100;return 1==t&&11!=a?e+"st":2==t&&12!=a?e+"nd":3==t&&13!=a?e+"rd":e+"th"},removeBCD(e,t){let a=e.findIndex((e=>e.key==t));return a>=0&&(e=e.splice(a,1)),e},setcitySessionCookie(t){if(void 0===t.id||0==t.id||""==t.id)return;this.setCookie("CityId",t.id,30);let a=this.getCookie("leadForm");""!=a&&void 0!==a?(void 0===a.choices&&(a.choices={}),void 0===a.formData&&(a.formData={}),a.formData.cityName=t.value,a.formData.cityId=t.id):a={choices:{},formData:{cityName:t.value,cityId:t.id}},this.setCookie("leadForm",a,30),e.setLocalStorageItem("citymid",a.formData.cityId)},setCookie(t,a,o,i,n,s="Lax"){if(void 0!==t&&void 0!==a&&"function"!=typeof a){"object"==typeof a&&(a=JSON.stringify(a));var r=new Date;r.setTime(r.getTime()+24*(o||30)*60*60*1e3);var l="expires="+r.toUTCString();if(document.cookie=`${t}=${n?encodeURIComponent(a):a};secure;${i?"":`${l};`}path=/;SameSite=${s};`,"CityId"===t)return e.setLocalStorageItem(t,a)}},getCookie(t,a){try{var o=[];if(null!=a&&void 0!==a&&a.length>0)o=a.split("; ");else if("undefined"!=typeof document)o=document.cookie.split("; ");else if("undefined"!=typeof navigator&&!navigator.cookieEnabled&&"CityId"===t)return e.getLocalStorageItem("CityId");for(var i=0,n=o.length;i<n;i++){var s=o[i].split("="),r=decodeURIComponent(s.shift()),l=s.join("=");if(t&&t===r){0===l.indexOf('"')&&(l=l.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return l=decodeURIComponent(l.replace(/\+/g," ")),l="object"!=typeof JSON.parse(l)||Array.isArray(JSON.parse(l))?l:JSON.parse(l)}catch(e){return l}}}}catch(e){console.log("ERR: Globals.getcookie: ",e.toString())}return"CityId"===t&&e.getLocalStorageItem("CityId")?e.getLocalStorageItem("CityId")+"":""}},a=e=>fetch("https://apib2c.gaadi.com/gaadinew/api/v1/vehicle/registration?"+new URLSearchParams(e),{method:"GET",headers:{"Content-type":"application/json; charset=UTF-8"}}),o=["MOTOR CAB(LPV)","GOODS CARRIER(LGV)","AGRICULTURAL TRACTOR(LMV)","GOODS CARRIER(HGV)","OMNI BUS (PRIVATE USE)(LMV)","ARTICULATED VEHICLE(HGV)","BUS(HPV)","EARTH MOVING EQUIPMENT(HGV)","MAXI CAB(LPV)","THREE WHEELER (GOODS)(3WT)","THREE WHEELER (PASSENGER)(3WT)","OMNI BUS(LMV)","LUXURY CAB(LPV)","DUMPER(HGV)","BUS(LPV)","AGRICULTURAL TRACTOR(OTH)","GOODS CARRIER(MGV)","GOODS CARRIER (HGV)"],i=["M-Cycle/Scooter(2WN)","Motor Cycle/Scooter-Used For Hire(2WT)","Three Wheeler (Goods)(3WT)","Three Wheeler (Passenger)(3WT)","Motorised Cycle (CC > 25cc)(2WN)","MOTOR CYCLE(SCR)","Moped(2WN)"],n={events:{},subscribe:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},unsubscribe:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))},publish:function(e,t){this.events[e]&&this.events[e].forEach((e=>{e(t)}))}};let s="";class r extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:"open"}),a=t.createTemplate('\n    <style>@import url(\'../../../gaadi/webcomponent/sellcar-widget/components/reg-input/reg-input-widget.css\');</style>\n    <div class="bottomContainerForm">\n        <div class="flotingInput">\n            <input class="inputBox form-input" id="inputVal" placeholder="none" name="inputVal" type="text" value="" />\n            <label class="form-label">Enter registration number (DL03 CW 3122)</label>\n        </div>\n        <div class="errorValidation" id="errorValidation"></div>\n        <button type="button" name="checkPrice" class="CTAButton" id="CTAButton">Check Price</button>\n    </div>').content.cloneNode(!0);e.appendChild(a),e.querySelector("#inputVal").value=this.getAttribute("value"),e.querySelector("#inputVal").setAttribute("required","required"),this.setAttribute("value",s)}connectedCallback(){this.shadowRoot.querySelector("#inputVal").addEventListener("input",(e=>this.handleRegNo(e))),this.shadowRoot.querySelector("#CTAButton").addEventListener("click",(()=>this.handleCheckPrice()))}handleRegNo(e){if(s=this.formatRegNumber(e.target.value),e.target.value=s,this.validateVehicleNo(e.target.value))return!0}validateVehicleNo(e){return!!e&&(/^[A-Za-z]{2}[0-9]{1,2}[A-Za-z]{0,3}[0-9]{4}$/.test(e.replace(/\-/g,""))||/^([0-9]{2}BH[0-9]{1,4}[A-HJ-NP-Z]{1,2})$/.test(e.replace(/\-/g,"")))}handleCheckPrice(){let e=s;if(this.validateVehicleNo(e)){let t=e.replace(/\-/g,"");if(t){let e={vehicle_no:t,api_type:1};this.shadowRoot.querySelector("#CTAButton").classList.add("orangeCircle_m"),a(e).then((e=>e.json())).then((e=>{if(this.shadowRoot.querySelector("#CTAButton").classList.remove("orangeCircle_m"),e&&e.data){const a=o.map((e=>e.toLowerCase().trim())),s=i.map((e=>e.toLowerCase().trim()));let r={};if(e.data.vehicle_class&&a.indexOf(e.data.vehicle_class.toLowerCase().trim())>-1)return r={message:"Sorry! We are not purchasing Commercial Cars currently.",registrationNo:t},void n.publish("gaadi-wc.invalidRegNo",r);if(e.data.vehicle_class&&s.indexOf(e.data.vehicle_class.toLowerCase().trim())>-1)return r={message:"Sorry! We are not purchasing Two Wheelers currently.",registrationNo:t},void n.publish("gaadi-wc.invalidRegNo",r);n.publish("gaadi-wc.success",e.data)}})).catch((e=>{console.error(e),this.shadowRoot.querySelector("#CTAButton").classList.remove("orangeCircle_m")}))}}else this.shadowRoot.querySelector("#errorValidation").innerHTML="Please enter valid registration no."}formatRegNumber(e){let t=[];return(e=(e=(e=e.replace(/\-/g,"")).replace(/\ /g,"")).toUpperCase()).length>0?((/^([0-9]{2}B)$/.test(e)||/^([0-9]{2}BH)$/.test(e)||/^([0-9]{2}BH[0-9]{1,4})$/.test(e)||/^([0-9]{2}BH[0-9]{1,4}[A-HJ-NP-Z]{1,2})$/.test(e))&&(t[0]=e.match(/\d{1,2}/)[0],e=e.replace(/\d{1,2}/,""),t[0]&&t[0].length>0&&e.match(/\D{1,2}/)&&e.match(/\D{1,2}/)[0]&&(t[1]=e.match(/\D{1,2}/)[0],e=e.replace(/\D{1,2}/,"")),e.match(/\d{1,4}/)&&e.match(/\d{1,4}/)[0]&&(t.push(e.match(/\d{1,4}/))[0],e=e.replace(/\d{1,4}/,"")),t[1]&&t[1].length>0&&e.length>0&&e.match(/\D{1,2}/)&&e.match(/\D{1,2}/)[0]&&(t.push(e.match(/\D{1,2}/))[0],e=e.replace(/\D{1,2}/,""))),t.length>0?t.join("-"):this.oldRegistrationFormat(e,t)):""}oldRegistrationFormat(e,t){return e.length>0&&e.match(/\D{1,2}/)&&e.match(/\D{1,2}/)[0]&&(t[0]=e.match(/\D{1,2}/)[0],e=e.replace(/\D{1,2}/,"")),t[0]&&t[0].length>0&&e.length>0&&e.match(/\d{1,2}/)&&e.match(/\d{1,2}/)[0]&&(t[1]=e.match(/\d{1,2}/)[0],e=e.replace(/\d{1,2}/,"")),t[1]&&t[1].length>0&&e.length>0&&e.match(/\D{1,3}/)&&e.match(/\D{1,3}/)[0]&&(t.push(e.match(/\D{1,3}/))[0],e=e.replace(/\D{1,3}/,"")),e.length>0&&e.match(/\d{1,4}/)&&e.match(/\d{1,4}/)[0]&&(t.push(e.match(/\d{1,4}/))[0],e=e.replace(/\d{1,4}/,"")),t.length>0?t.join("-"):""}}customElements.define("reg-input-widget",r);class l extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.isVisible=!1,this.render()}render(){const e=`\n            <style>@import url('../../../../gaadi/webcomponent/sellcar-widget/components/pop-up/pop-up-widget.css');</style>\n            <div class="modal ${this.isVisible?"show-modal":"hidden"}">\n                <div class="modal-content">\n                    <div class="modelHeaderSection">\n                        <div class="crossButton" id="closeButton">×</div>\n                    </div>\n                    <div class="modelBodySection" id="modelBodySection"></div>\n                </div>\n            </div>`;this.shadowRoot.innerHTML=e}connectedCallback(){this.shadowRoot.querySelector("#closeButton").addEventListener("click",(()=>this.closeModal())),n.subscribe("gaadi-wc.success",(e=>this.onRegNumberSuccess(e))),n.subscribe("gaadi-wc.apptdropopen",(()=>this.openModal()))}onRegNumberSuccess(t){let a=e.getLocalStorageItem("GaadiData")||{};t&&""==t.userName&&delete t.userName;let o={...a,...t};o.variantName=o.variant_name,o.variantId=o.variant_id,o.brandImageUrl=o.brand_image_url,o.oemImage=o.brand_image_url,o.bcdList=[],o.owner_count=t.owner_count?t.owner_count:"",delete o.variant_id,delete o.variant_name,delete o.brand_image_url;let i="";e.setLocalStorageItem("GaadiData",o),this.getRedirectionStep(t,(t=>{const a=e.getLocalStorageItem("GaadiData")||{};a.step=t,i=t||"/make",e.setLocalStorageItem("GaadiData",a),this.pushBcdDataForReg(),this.openPopupWithStep(i)}))}openModal(){let t=e.getLocalStorageItem("GaadiData")||{},a=t.step?t.step:"/make";this.openPopupWithStep(a)}getIframeTemplates(e,t){return`<iframe src="${e}" id="${t}" width="100%" height="100%"></iframe>`}openPopupWithStep(e=""){this.shadowRoot.querySelector(".modal").classList.toggle("show-modal");let t=this.getIframeTemplates(`http://localhost/sell-used-car${e}?isiframe=1`,"cardekhoiframe");this.shadowRoot.querySelector(".modelBodySection").innerHTML=t}getRedirectionStep(t,a){const o=e.getLocalStorageItem("GaadiData")||{};let i=t.period&&t.modelId?"/variant":"/make";""!==t.variant_id&&""!==t.variant_name?(e.setLocalStorageItem("GaadiData",o),t.owner_count?a("/odometer"):a("/ownership")):a(`${i}`)}pushBcdDataForReg(){let a=e.getLocalStorageItem("GaadiData");if(a.make&&a.makeId)if(t.handleBcdUpdate({value:a.make,key:"make",returnUrl:"/make",group:"group1"},null,0),a.period)t.handleBcdUpdate({value:a.period,key:"period",returnUrl:"/period",group:"group1"},null,1),a.modelId&&t.handleBcdUpdate({value:a.modelName,key:"model",returnUrl:"/model",group:"group1"},null,2),a.variantId&&a.variantName&&t.handleBcdUpdate({value:a.variantName,key:"variant",returnUrl:"/variant",group:"group1"},null,3),a.owner_count&&t.handleBcdUpdate({value:`${t.ordinal_suffix_of(a.owner_count)} owner`,key:"owner_count",returnUrl:"/ownership",group:"group1"},null,4);else{let o=a.bcdList||[];o=t.removeBCD(o,"make"),o=t.removeBCD(o,"model"),o=t.removeBCD(o,"variant"),a.bcdList=o,e.setLocalStorageItem("GaadiData",a)}else{let o=a.bcdList||[];o=t.removeBCD(o,"make"),o=t.removeBCD(o,"period"),o=t.removeBCD(o,"model"),o=t.removeBCD(o,"variant"),a.bcdList=o,e.setLocalStorageItem("GaadiData",a)}}closeModal(){const t=e.getLocalStorageItem("GaadiData")||{};n.publish("gaadi-wc.iframeClosed",t),this.shadowRoot.querySelector(".modal").classList.toggle("show-modal")}}customElements.define("pop-up-widget",l);class d extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:"open"}),a=t.createTemplate('\n    <style>@import url(\'../../webcomponent/sellcar-widget/components/thank-you/thank-you-widget.css\');</style>\n    <div class="sellThankyouWidget">\n        <h1 class="mainHeadingText">Thank you!</h1>\n        <h2 class="mainSubHeadingText">Our team will get in touch with you soon.</h2>\n        <div class="brandImageBottom">\n            <img src="https://stimg.cardekho.com/pwa/img/ucrN/aK.png" alt="brand image" />\n        </div>\n    </div>').content.cloneNode(!0);e.appendChild(a)}connectedCallback(){e.getLocalStorageItem("GaadiData")}}customElements.define("thank-you-widget",d);class c extends HTMLElement{constructor(){super();const a=this.attachShadow({mode:"open"});e.getLocalStorageItem("GaadiData");const o=t.createTemplate('\n    <style>\n    @import url(\'../../../../../gaadi/webcomponent/sellcar-widget/css/style.css\');\n    </style>\n    <div class="sellCarWidget">\n    <div class="topContainerText">\n        <h1 class="mainHeading">Book Home Inspection to get the <strong class="greenText">Best price*</strong></h1>\n        <div class="brandImage">\n            <img src="https://stimg.cardekho.com/pwa/img/ucrN/cardekhoAk_sm.png" alt="brand image"/>\n        </div>\n    </div>\n    <button type="button" name="checkPrice" class="CTAButton" id="bookNow">Book Now</button>\n</div>\n    ').content.cloneNode(!0);a.appendChild(o),this.handleBookNow=this.handleBookNow.bind(this),this.shadowRoot.querySelector("#bookNow").addEventListener("click",(()=>this.handleBookNow()))}handleBookNow(){console.log("in book now"),n.publish("gaadi-wc.apptdropopen",{})}isYearSameInBookedAppointment(){let t=!1,a=e.getLocalStorageItem("GaadiData")||{};return a&&a.bookedAppointment&&a.bookedAppointment.Vehicle_Detail&&a.bookedAppointment.Vehicle_Detail.year_id&&(t=a.year_id==a.bookedAppointment.Vehicle_Detail.year_id),t}}customElements.define("appointment-drop-widget",c);let m="";class h extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),n.subscribe("gaadi-wc.invalidRegNo",(e=>this.openPopup(e)))}openPopup(e){console.log("data",e),m=e;const a=t.createTemplate('\n<style>@import url(\'../../webcomponent/sellcar-widget/components/invalid-vehicle-alert/invalid-vehicle-widget.css\');</style>\n<div class="modal">\n  <div class="modal-content">\n      <div class="modelHeaderSection">\n          <div class="crossButton" id="closeButton">×</div>\n      </div>\n      <div class="modelBodySection">\n      <h2 class="popupHeading" id="modelBodySection"></h2>\n        <div class="rejNumber">\n            <span id="showRegNo"><span>\n            <div class="changeNumberCTA">Change</div>\n        </div>\n      </div>\n  </div>\n</div>').content.cloneNode(!0);this.shadowRoot.appendChild(a),this.shadowRoot.querySelector(".modal").classList.toggle("show-modal"),this.shadowRoot.querySelector("#modelBodySection").innerHTML=e.message,this.shadowRoot.querySelector("span").innerHTML=e.registrationNo}connectedCallback(){console.log("subscribed------",m)}}customElements.define("invalid-vehicle-widget",h);class p extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});const e=t.createTemplate('\n    <style>\n    @import url(\'../../../../../gaadi/webcomponent/sellcar-widget/css/style.css\');\n    </style>\n    <div class="sellCarWidget">\n        <div class="topContainerText">\n            <h1 class="mainHeading">Sell your car at the <strong class="greenText">Best price*</strong></h1>\n            <div class="brandImage">\n                <img src="https://stimg.cardekho.com/pwa/img/ucrN/cardekhoAk_sm.png" alt="brand image"/>\n            </div>\n        </div>\n        <div id="mainContainer">\n            <reg-input-widget></reg-input-widget>\n            <invalid-vehicle-widget></invalid-vehicle-widget>\n            <pop-up-widget show="false"></pop-up-widget>\n        </div>\n    </div>\n    ').content.cloneNode(!0);this.shadowRoot.appendChild(e)}}customElements.define("home-widget",p);let u="default",g="dropoff",v="apptsuccess";const w={userName:"userName",mobileNo:"mobileNo",citymid:"citymid",isVerified:"isVerified",env:"env",cityname:"cityname"};class y extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.activeTemplate=this.getTemplateBasedOnGaadiData(),this.render()}render(){let e=`\n        <style>\n        @import url('../../webcomponent/sellcar-widget/css/style.css');\n        </style>\n        <div>\n            ${this.activeTemplate==u?'<home-widget show="false"></home-widget>':""}\n            ${this.activeTemplate==g?"<appointment-drop-widget id='appt-drop-widget' show='false'></appointment-drop-widget>":""}\n            ${this.activeTemplate==v?"<thank-you-widget id='thanks-widget' show='false'></thank-you-widget>":""}\n            <pop-up-widget></pop-up-widget>\n        </div>\n        `;console.log(e),this.shadowRoot.innerHTML=e}getTemplateBasedOnGaadiData(){let t=u,a=e.getLocalStorageItem("GaadiData")||{},o=a.bookedAppointment||{},i=!(!o||!o.ref_code);return t=a&&i?v:a&&a.variantId?g:u,t}renderOnClose(){this.activeTemplate=this.getTemplateBasedOnGaadiData(),this.render()}connectedCallback(){let a=this;n.subscribe("gaadi-wc.iframeClosed",(e=>this.renderOnClose(e)));let o={};Object.keys(w).forEach((e=>{o[e]=a.shadowRoot.host.getAttribute(w[e])}));let i=e.getLocalStorageItem("GaadiData")||{};i.userName=o[w.userName],i.mobileNo=o[w.mobileNo];let s=o[w.citymid],r=o[w.cityname];if(s&&r){let e={id:s,value:r};t.setcitySessionCookie(e)}}}customElements.define("cross-sell-widget",y)})();
